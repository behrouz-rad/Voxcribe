<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Voxcribe.Desktop.ViewModels"
             xmlns:domain="using:Voxcribe.Engine.Domain"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Voxcribe.Desktop.Views.RecordingView"
             x:DataType="vm:RecordingViewModel">

    <Grid Margin="20" RowDefinitions="Auto,Auto,*,Auto">
        
        <!-- Recording Controls -->
        <Border Grid.Row="0" 
                Padding="20"
                CornerRadius="8"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
            <StackPanel Spacing="15">
                <TextBlock Text="Microphone Recording"
                           FontSize="18"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"/>
                
                <!-- Recording Timer -->
                <TextBlock Text="{Binding RecordingDuration, StringFormat='{}{0:mm\\:ss}'}"
                           FontSize="48"
                           FontWeight="Light"
                           HorizontalAlignment="Center"
                           Foreground="{Binding IsRecording, Converter={StaticResource RecordingColorConverter}}"
                           Margin="0,10"/>
                
                <!-- Buttons -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Spacing="15">
                    <Button Content="Start Recording"
                            Command="{Binding StartRecordingCommand}"
                            IsVisible="{Binding !IsRecording}"
                            Padding="30,12"
                            FontSize="16"
                            Classes="accent"/>
                    
                    <Button Content="Stop Recording"
                            Command="{Binding StopRecordingCommand}"
                            IsVisible="{Binding IsRecording}"
                            Padding="30,12"
                            FontSize="16"
                            Classes="accent"/>
                    
                    <Button Content="Cancel"
                            Command="{Binding CancelRecordingCommand}"
                            IsVisible="{Binding IsRecording}"
                            Padding="20,12"
                            FontSize="16"/>
                </StackPanel>
                
                <TextBlock Text="Click 'Start Recording' to begin capturing audio from your microphone"
                           HorizontalAlignment="Center"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           FontStyle="Italic"
                           IsVisible="{Binding !IsRecording}"/>
            </StackPanel>
        </Border>

        <!-- Transcription Controls -->
        <Border Grid.Row="1" 
                Margin="0,15,0,0"
                Padding="15"
                CornerRadius="8"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                IsVisible="{Binding RecordedFilePath, Converter={StaticResource StringNotEmptyConverter}}">
            <Grid ColumnDefinitions="Auto,200,Auto,180,*,Auto">
                <TextBlock Grid.Column="0"
                           Text="Model:"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"
                           FontWeight="SemiBold"/>
                
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding AvailableModels}"
                          SelectedItem="{Binding SelectedModel}"
                          VerticalAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="{Binding Name}"/>
                                <TextBlock Text="✓" 
                                           Foreground="Green"
                                           IsVisible="{Binding IsAvailableLocally}"/>
                                <TextBlock Text="(not downloaded)"
                                           Foreground="Gray"
                                           FontSize="11"
                                           IsVisible="{Binding !IsAvailableLocally}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Grid.Column="2"
                           Text="Language:"
                           VerticalAlignment="Center"
                           Margin="20,0,10,0"
                           FontWeight="SemiBold"/>
                
                <ComboBox Grid.Column="3"
                          ItemsSource="{Binding AvailableLanguages}"
                          SelectedItem="{Binding SelectedLanguage}"
                          VerticalAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                
                <Button Grid.Column="5"
                        Content="Transcribe Recording"
                        Command="{Binding TranscribeCommand}"
                        IsEnabled="{Binding !IsTranscribing}"
                        Padding="30,8"
                        Margin="10,0,0,0"
                        Classes="accent"/>
            </Grid>
        </Border>

        <!-- Transcription Output -->
        <Border Grid.Row="2"
                Margin="0,15,0,0"
                Padding="15"
                CornerRadius="8"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0"
                           Text="Transcription"
                           FontWeight="SemiBold"
                           Margin="0,0,0,10"/>
                
                <ScrollViewer Grid.Row="1">
                    <TextBox Text="{Binding TranscriptionText}"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             MinHeight="200"
                             BorderThickness="0"
                             Background="Transparent"
                             Watermark="Transcription will appear here..."/>
                </ScrollViewer>
                
                <StackPanel Grid.Row="2" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="10"
                            Margin="0,10,0,0"
                            IsVisible="{Binding TranscriptionText, Converter={StaticResource StringNotEmptyConverter}}">
                    <Button Content="Copy to Clipboard"
                            Command="{Binding CopyCommand}"
                            Padding="20,8"/>
                    <Button Content="Export to File"
                            Command="{Binding ExportCommand}"
                            Padding="20,8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3"
                Margin="0,15,0,0"
                Padding="15,10"
                CornerRadius="8"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            Spacing="10"
                            IsVisible="{Binding IsTranscribing}">
                    <ProgressBar Value="{Binding Progress}"
                                 Width="200"
                                 Height="20"
                                 VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Progress, StringFormat='{}{0:F0}%'}"
                               VerticalAlignment="Center"
                               MinWidth="40"/>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>

</UserControl>
